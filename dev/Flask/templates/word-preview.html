<!DOCTYPE html>
<html lang="zh-Hant-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>單字預覽</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>

<body>
    <nav class="container-header">
        <div class="header">
            <a href="{{ url_for('index') }}">
                <img src="{{ url_for('static', filename='img/logo.png') }}" alt="Logo">
            </a>
            <nav>
                <a href="/">我的單字書</a>
                <a href="/about">關於我們</a>
            </nav>
            <div class="user">
                <div class="user-icon"></div>
                <span>User Name</span>
            </div>
        </div>
    </nav>

    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner" style="display: none;">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <h1>單字預覽</h1>
        <div class="preview-section">
            <div class="image-preview-container">
                <img class="image-preview" alt="Uploaded Image">
            </div>
            <div class="words-list">
                <h2>可能的單字</h2>
                <div id="word-container"></div>
                <div class="center-button-container">
                    <button class="button" onclick="sendWords()">確認</button>
                </div>
            </div>
        </div>
    </div>
        


    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const image = urlParams.get('image');
            const words = JSON.parse(urlParams.get('words'));

            // 設置圖像
            document.querySelector('.image-preview').src = `/static/uploads/${image}`;

            // 渲染單詞列表
            const wordContainer = document.getElementById('word-container');
            words.forEach(word => {
                const wordItem = document.createElement('div');
                wordItem.className = 'word-item';

                const wordText = document.createElement('div');
                wordText.className = 'word-text';
                wordText.textContent = word;

                const deleteButton = document.createElement('div');
                deleteButton.className = 'delete-button';
                deleteButton.onclick = () => deleteWord(word);

                const deleteIcon = document.createElement('img');
                deleteIcon.src = '/static/img/X.svg';
                deleteIcon.alt = 'delete';

                deleteButton.appendChild(deleteIcon);
                wordItem.appendChild(wordText);
                wordItem.appendChild(deleteButton);
                wordContainer.appendChild(wordItem);
            });
        });



        function sendWords() {
            const words = [];
            
            //使用 document.querySelectorAll('.word-text') 選取所有帶有 .word-text 類的元素。
            //遍歷這些元素，將每個元素的文本內容（去除前後空格）加入到 words 數組中。
            
            document.querySelectorAll('.word-text').forEach(element => {
                words.push(element.textContent.trim());
            });

            fetch('/process_words', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ words: words })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // 如果后端重定向，前端可以直接跟随重定向或者在这里处理 URL 参数
                window.location.href = response.url; // 这会跟随后端的重定向到首页
            })
            .catch(error => {
                console.error('Error:', error);
            });
        }
    </script>


    <script>
        function deleteWord(word) {
            // 使用 document.querySelectorAll('.word-item') 選取所有帶有 .word-item 類的元素。
            const wordItems = document.querySelectorAll('.word-item');
            
            wordItems.forEach(item => {
                // 遍歷這些單詞項，獲取每個單詞項中 .word-text 類的文本內容
                const wordText = item.querySelector('.word-text').textContent;
                
                // 如果文本內容與要刪除的單詞 word 匹配，則移除該單詞項。
                if (wordText === word) {
                    // 移除匹配的单词项
                    item.remove();
                }
            });
        }
    </script>


 
        
</body>
</html>






